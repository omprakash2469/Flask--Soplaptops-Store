{% extends 'main/layout.html' %}
{% block body %}

<!-- MAIN SECTION  -->
<main class="py-7">
    <!-- ABOUT HEADING -->
    <div class="heading-box bg-gray-100 py-8 px-4 lg:py-12">
        <h1 class="text-2xl md:w-[720px] md:m-auto lg:w-[90%] xl:w-[1200px]">Welcome! {{session['username']|title()}}
        </h1>
    </div>
    <div class="content-wrapper lg:flex lg:w-[90%] lg:m-auto xl:w-[1200px] xl:py-16">
        <!-- ABOUT SECTION -->
        <div class="content-box md:w-[720px] md:mx-auto lg:w-1/4">
            <ul class="bg-gray-100" id="userTabs">
                <li class="cursor-pointer block p-5 hover:bg-gray-200 transition-all font-semibold bg-gray-200">
                    Dashboard</li>
                <li class="cursor-pointer block p-5 hover:bg-gray-200 transition-all font-semibold">Orders</li>
                <li class="cursor-pointer block p-5 hover:bg-gray-200 transition-all font-semibold">Account</li>
            </ul>
            <a href="{{url_for('users.logout')}}"
                class="block p-5 hover:bg-gray-200 bg-gray-100 transition-all font-semibold">Logout</a>
        </div>

        <div class="about-info px-4 md:px-0 md:w-[720px] md:m-auto lg:w-3/4 lg:ml-5 lg:my-0 overflow-hidden"
            id="userBlocks">
            <!-- DASHBOARD -->
            <div class="bg-gray-100 py-6 px-5">
                <h1 class="text-xl sm:text-2xl"><span class="underline underline-offset-8">YO</span>UR ACTIVITY
                </h1>
                {% with messages = get_flashed_messages(with_categories=True) %}
                {% if messages %}
                {% for category, message in messages %}
                <div>
                    <p class="{{category}} font-semibold mt-5">{{message}}</p>
                </div>
                {% endfor %}
                {% endif %}
                {% endwith %}

                <div class="para mt-12 text-justify sm:text-left">
                    <p>Lorem ipsum dolor, sit amet consectetur adipisicing elit. Earum ipsam deleniti dolorem natus,
                        suscipit perferendis doloribus facere minima tenetur, quibusdam minus numquam a corporis
                        molestias ut, quos consectetur. Error, minima! <br></p>
                    <br>
                    <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Pariatur officiis consequatur nulla
                        nesciunt tempore consequuntur quos ea amet eligendi adipisci praesentium reiciendis rec
                        exercitationem inventoreeniet libero! Recusandae, laborum optio! Omnis assumenda illum rerum
                        explicabo, dolorem alias atque doloremque quasi quos, consectetur veritatis maxime numquam vero.
                        Voluptatibus quasi magnam ratione laborum quod aut nobis assumenda vel rerum </p>
                </div>
            </div>

            <!-- ORDERS -->
            <div class="mx-auto max-w-7xl pb-6 hidden">
                <div
                    class="flex flex-col xl:flex-row jusitfy-center items-stretch w-full xl:space-x-8 space-y-4 md:space-y-6 xl:space-y-0">
                    <div class="flex flex-col justify-start items-start w-full space-y-4 md:space-y-6 xl:space-y-8">
                        <div
                            class="flex flex-col justify-start items-start  bg-gray-50 px-4 py-4 md:py-6 md:p-6 xl:p-8 w-full">
                            {% if orders %}
                            <p class="text-lg md:text-xl  font-semibold leading-6 xl:leading-5 text-gray-800">
                                Your Orders</p>
                            {% for order in orders %}
                            <div
                                class="mt-4 md:mt-6 flex flex-col md:flex-row justify-start items-start md:items-center md:space-x-6 xl:space-x-8 w-full">
                                <div class="pb-4 md:pb-8 w-full md:w-40">
                                    <img class="w-full hidden md:block rounded-md" src="{{orders[order]['image']}}"
                                        alt="dress" />
                                    <img class="w-full md:hidden rounded-md" src="{{orders[order]['image']}}"
                                        alt="dress" />
                                </div>
                                <div
                                    class="border-b border-gray-200 md:flex-row flex-col flex justify-between items-start w-full pb-8 space-y-4 md:space-y-0">
                                    <div class="w-full flex flex-col justify-start items-start space-y-8">
                                        <h3
                                            class="text-xl xl:text-2xl font-semibold leading-6 text-gray-800 hover:text-gray-600">
                                            <a
                                                href="{{orders[order]['product_url']}}">{{orders[order]['name']|title()}}</a>
                                        </h3>
                                        <div class="flex justify-start items-start flex-col space-y-2">
                                            <p class="text-base  leading-none text-gray-800"><span
                                                    class=" text-gray-500">Order Date: </span>
                                                <strong>{{orders[order]['order_date']}}</strong>
                                            </p>
                                            <p class="text-base  leading-none text-gray-800"><span
                                                    class=" text-gray-500">Category: </span>
                                                <strong>{{orders[order]['category']|upper()}}</strong>
                                            </p>
                                        </div>
                                    </div>
                                    <div class="space-x-8 w-full flex justify-between flex-col">
                                        <div class="flex justify-between items-start">
                                            <p class="text-base  xl:text-lg leading-6 text-gray-800">Qty.
                                                {{orders[order]['quantity']}}</p>
                                            <p class="text-base  xl:text-lg font-semibold leading-6 text-gray-800">
                                                Rs. {{orders[order]['price']}}</p>
                                        </div>
                                        <form action="{{url_for('users.cancelOrder')}}" method="post" class="flex justify-end">
                                            <input type="hidden" name="orderid" value="{{order}}">
                                            <button type="submit" class="block text-right mt-8">Cancel</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                            {% else %}
                            <p class="text-xl font-semibold py-3">No Orders Yet</p>
                            <a href="{{url_for('main.index')}}#trendyProducts"
                                class="text-blue-500 hover:text-blue-800 font-semibold transition-all">Continue Shopping
                                ></a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- ACCOUNT -->
            <div class=" bg-gray-100 shadow sm:rounded-lg hidden">
                <div class="px-4 py-5 sm:px-6 flex justify-between items-center">
                    <div>
                        <h3 class="text-lg font-medium leading-6 text-gray-900">Applicant Information</h3>
                        <p class="mt-1 max-w-2xl text-sm text-gray-500">Personal details and application.</p>
                    </div>
                    <button class="py-2 px-5 bg-gray-800 hover:bg-gray-700 rounded-md text-white"
                        onclick="updateModelOpen()">Edit</button>
                </div>
                <div class="border-t border-gray-200">
                    {% if user %}
                    <dl>
                        {% for key in user %}
                        <div class="bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                            <dt class="text-sm font-medium text-gray-500 uppercase">{{key}}</dt>
                            <dd class="mt-1 text-sm text-gray-900 sm:col-span-2 sm:mt-0">{{user[key]}}</dd>
                        </div>
                        {% endfor %}
                    </dl>
                    {% else %}
                    <p>No User Found</p>
                    {% endif %}
                </div>
            </div>

            <!-- Account Update Modal Form -->
            <div class="relative z-10 hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true"
                id="infoedit">
                <!--
                  Background backdrop, show/hide based on modal state.
              
                  Entering: "ease-out duration-300"
                    From: "opacity-0"
                    To: "opacity-100"
                  Leaving: "ease-in duration-200"
                    From: "opacity-100"
                    To: "opacity-0"
                -->
                <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"></div>

                <div class="fixed inset-0 z-10 overflow-y-auto">
                    <div class="flex min-h-full items-end justify-center p-7 text-center sm:items-center sm:p-0">
                        <!--
                      Modal panel, show/hide based on modal state.
              
                      Entering: "ease-out duration-300"
                        From: "opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
                        To: "opacity-100 translate-y-0 sm:scale-100"
                      Leaving: "ease-in duration-200"
                        From: "opacity-100 translate-y-0 sm:scale-100"
                        To: "opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
                    -->
                        <form method="POST" action="{{url_for('users.dashboard')}}"
                            class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-xl">
                            <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                                <div class="mt-3 text-center sm:mt-0 sm:text-left">
                                    <h3 class="text-lg font-medium leading-6 text-gray-900" id="modal-title">Edit
                                        Information</h3>
                                    <hr class="my-7">
                                    <div class="mt-4">
                                        <div class="flex items-center mb-6">
                                            <div class="pr-2 w-1/4 text-left">
                                                {{form.name.label()}}
                                            </div>
                                            <div class="w-3/4">
                                                {{form.name(class="relative block w-full appearance-none rounded-none
                                                rounded-t-md border border-gray-300 px-4 py-3 text-gray-900
                                                placeholder-gray-500 focus:z-10 focus:border-indigo-500
                                                focus:outline-none focus:ring-indigo-500 sm:text-base",
                                                placeholder="Full Name", value=user['name'])}}
                                            </div>
                                        </div>
                                        <div class="flex mb-6 items-center">
                                            <div class="pr-2 w-1/4 text-left">
                                                {{form.number.label()}}
                                            </div>
                                            <div class="w-3/4">
                                                {{form.number(class="relative block w-full appearance-none rounded-none
                                                rounded-t-md border border-gray-300 px-4 py-3 text-gray-900
                                                placeholder-gray-500 focus:z-10 focus:border-indigo-500
                                                focus:outline-none focus:ring-indigo-500 sm:text-base",
                                                placeholder="Number", value=user['number'])}}
                                            </div>
                                        </div>
                                        <div class="flex mb-6 items-center">
                                            <div class="pr-2 w-1/4 text-left">
                                                {{form.email.label()}}
                                            </div>
                                            <div class="w-3/4">
                                                {{form.email(class="relative block w-full appearance-none rounded-none
                                                rounded-t-md border border-gray-300 px-4 py-3 text-gray-900
                                                placeholder-gray-500 focus:z-10 focus:border-indigo-500
                                                focus:outline-none focus:ring-indigo-500 sm:text-base",
                                                placeholder="Email Address", value=user['email'])}}
                                            </div>
                                        </div>
                                        <div class="flex mb-6 items-center">
                                            <div class="pr-2 w-1/4 text-left">
                                                {{form.address.label()}}
                                            </div>
                                            <div class="w-3/4">
                                                {{form.address(class="relative block w-full appearance-none rounded-none
                                                rounded-t-md border border-gray-300 px-4 py-3 text-gray-900
                                                placeholder-gray-500 focus:z-10 focus:border-indigo-500
                                                focus:outline-none focus:ring-indigo-500 sm:text-base",
                                                placeholder="Address", value=user['address'])}}
                                            </div>
                                        </div>
                                        <div class="flex mb-6 items-center">
                                            <div class="pr-2 w-1/4 text-left">
                                                {{form.street.label()}}
                                            </div>
                                            <div class="w-3/4">
                                                {{form.street(class="relative block w-full appearance-none rounded-none
                                                rounded-t-md border border-gray-300 px-4 py-3 text-gray-900
                                                placeholder-gray-500 focus:z-10 focus:border-indigo-500
                                                focus:outline-none focus:ring-indigo-500 sm:text-base",
                                                placeholder="Street / Area", value=user['street'])}}
                                            </div>
                                        </div>
                                        <div class="flex mb-6 items-center">
                                            <div class="pr-2 w-1/4 text-left">
                                                {{form.zipcode.label()}}
                                            </div>
                                            <div class="w-3/4">
                                                {{form.zipcode(class="relative block w-full appearance-none rounded-none
                                                rounded-t-md border border-gray-300 px-4 py-3 text-gray-900
                                                placeholder-gray-500 focus:z-10 focus:border-indigo-500
                                                focus:outline-none focus:ring-indigo-500 sm:text-base",
                                                placeholder="Zipcode", value=user['zipcode'])}}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-gray-50 px-4 py-3 sm:flex sm:px-6 justify-between">
                                {{form.csrf_token()}}
                                {{form.id(value=session['id'])}}
                                <button type="button"
                                    class="mt-3 inline-flex w-full justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-base font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 sm:mt-0 sm:w-auto sm:text-sm"
                                    id="close">Close</button>
                                {{form.update(class="inline-flex w-full justify-center rounded-md border
                                border-transparent bg-blue-600 px-4 py-2 text-base font-medium text-white shadow-sm
                                hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500
                                focus:ring-offset-2 sm:ml-3 sm:w-auto sm:text-sm cursor-pointer")}}

                            </div>
                        </form>
                    </div>
                </div>
            </div>

        </div>
    </div>
    </div>
</main>
<!--/ MAIN SECTION  -->

<script>
    // ---------- User Information Update Model ---------- //
    let modal = document.getElementById('infoedit');
    function updateModelOpen() {
        modal.classList.toggle('hidden');
    }
    let close = document.getElementById('close');
    close.addEventListener('click', () => {
        modal.classList.toggle('hidden')
    })
</script>
<script src="{{url_for('static', filename='assets/js/users.js')}}"></script>
{% endblock %}